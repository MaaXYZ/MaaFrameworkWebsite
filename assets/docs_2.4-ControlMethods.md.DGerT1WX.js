import{_ as t,c as d,o as a,a2 as e}from"./chunks/framework.CU_Lz0Mo.js";const i=JSON.parse('{"title":"2.4 控制方式说明","description":"","frontmatter":{},"headers":[],"relativePath":"docs/2.4-ControlMethods.md","filePath":"docs/2.4-控制方式说明.md","lastUpdated":null}');const o=t({name:"docs/2.4-ControlMethods.md"},[["render",function(t,i,o,r,s,l){return a(),d("div",null,[...i[0]||(i[0]=[e('<h1 id="_2-4-控制方式说明" tabindex="-1">2.4 控制方式说明 <a class="header-anchor" href="#_2-4-控制方式说明" aria-label="Permalink to &quot;2.4 控制方式说明&quot;">​</a></h1><p>本文档详细说明 MaaFramework 中 Screencap（截图）和 Input（控制）的各种方式及其配置。</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p></p><ul><li>对于 API ，screencap/input 使用 <code>int</code> 类型（按位或组合）；对于 <a href="3.3-ProjectInterfaceV2">ProjectInterface V2</a>，使用 <code>string</code> 类型（直接使用名称）。</li><li><a href="3.3-ProjectInterfaceV2">ProjectInterface V2</a> 仅支持配置 Win32 控制器的 screencap/mouse/keyboard 方式。Adb 控制器的 screencap/input 使用 <code>MaaToolkitAdbDeviceFind</code> 自动检测和选择最优方式，无需手动配置。</li></ul></div><h2 id="adb" tabindex="-1">Adb <a class="header-anchor" href="#adb" aria-label="Permalink to &quot;Adb&quot;">​</a></h2><h3 id="adb-input" tabindex="-1">Adb Input <a class="header-anchor" href="#adb-input" aria-label="Permalink to &quot;Adb Input&quot;">​</a></h3><blockquote><p>参考 <a href="https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L227-L240" target="_blank" rel="noopener noreferrer">MaaDef.h</a></p></blockquote><p>将下面选择的方式 <strong>按位或</strong> 合并为一个值提供。MaaFramework 将会按照固定优先级顺序尝试所有提供的方式，选择首个可用方式。</p><p>默认尝试除 EmulatorExtras 外所有方式。</p><blockquote><p>优先级: EmulatorExtras &gt; Maatouch &gt; MinitouchAndAdbKey &gt; AdbShell</p></blockquote><table tabindex="0"><thead><tr><th>名称</th><th>API 值</th><th>速度</th><th>兼容性</th><th>说明</th></tr></thead><tbody><tr><td>AdbShell</td><td><code>1</code></td><td>慢</td><td>高</td><td></td></tr><tr><td>MinitouchAndAdbKey</td><td><code>2</code></td><td>快</td><td>中</td><td>按键仍使用 AdbShell</td></tr><tr><td>Maatouch</td><td><code>4</code></td><td>快</td><td>中</td><td></td></tr><tr><td>EmulatorExtras</td><td><code>8</code></td><td>快</td><td>低</td><td>仅支持模拟器：MuMu 12</td></tr></tbody></table><h3 id="adb-screencap" tabindex="-1">Adb Screencap <a class="header-anchor" href="#adb-screencap" aria-label="Permalink to &quot;Adb Screencap&quot;">​</a></h3><blockquote><p>参考 <a href="https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L208-L225" target="_blank" rel="noopener noreferrer">MaaDef.h</a></p></blockquote><p>将下面选择的方式 <strong>按位或</strong> 合并为一个值提供。MaaFramework 将会尝试所有提供的方式，选择最快的可用方式。</p><p>默认尝试除 <code>RawByNetcat</code>，<code>MinicapDirect</code>，<code>MinicapStream</code> 外所有方式。</p><p><code>MinicapDirect</code> 和 <code>MinicapStream</code> 由于会编码为 jpg，为有损编码，将显著降低模板匹配的效果，不建议使用。</p><table tabindex="0"><thead><tr><th>名称</th><th>API 值</th><th>速度</th><th>兼容性</th><th>编码</th><th>说明</th></tr></thead><tbody><tr><td>EncodeToFileAndPull</td><td><code>1</code></td><td>慢</td><td>高</td><td>无损</td><td></td></tr><tr><td>Encode</td><td><code>2</code></td><td>慢</td><td>高</td><td>无损</td><td></td></tr><tr><td>RawWithGzip</td><td><code>4</code></td><td>中</td><td>高</td><td>无损</td><td></td></tr><tr><td>RawByNetcat</td><td><code>8</code></td><td>快</td><td>低</td><td>无损</td><td></td></tr><tr><td>MinicapDirect</td><td><code>16</code></td><td>快</td><td>低</td><td>有损</td><td></td></tr><tr><td>MinicapStream</td><td><code>32</code></td><td>极快</td><td>低</td><td>有损</td><td></td></tr><tr><td>EmulatorExtras</td><td><code>64</code></td><td>极快</td><td>低</td><td>无损</td><td>仅支持模拟器：MuMu 12、雷电 9</td></tr></tbody></table><h2 id="win32" tabindex="-1">Win32 <a class="header-anchor" href="#win32" aria-label="Permalink to &quot;Win32&quot;">​</a></h2><h3 id="win32-input" tabindex="-1">Win32 Input <a class="header-anchor" href="#win32-input" aria-label="Permalink to &quot;Win32 Input&quot;">​</a></h3><blockquote><p>参考 <a href="https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L252-L259" target="_blank" rel="noopener noreferrer">MaaDef.h</a></p></blockquote><p>选择下面的值提供。</p><p>无默认值。Client 可以选择一个作为默认值。</p><p>Win32 下不同程序处理输入的方法不同，不存在一个通用方式。</p><table tabindex="0"><thead><tr><th>名称</th><th>API 值</th><th>兼容性</th><th>需管理员权限</th><th>抢占鼠标</th><th>支持后台</th><th>说明</th></tr></thead><tbody><tr><td>Seize</td><td><code>1</code></td><td>高</td><td>否</td><td>是</td><td>否</td><td></td></tr><tr><td>SendMessage</td><td><code>2</code></td><td>中</td><td>可能</td><td>否</td><td>是</td><td></td></tr><tr><td>PostMessage</td><td><code>4</code></td><td>中</td><td>可能</td><td>否</td><td>是</td><td></td></tr><tr><td>LegacyEvent</td><td><code>8</code></td><td>低</td><td>否</td><td>是</td><td>否</td><td></td></tr><tr><td>PostThreadMessage</td><td><code>16</code></td><td>低</td><td>可能</td><td>否</td><td>是</td><td></td></tr><tr><td>SendMessageWithCursorPos</td><td><code>32</code></td><td>中</td><td>可能</td><td>短暂</td><td>是</td><td>专为原神等检测实际鼠标位置的游戏设计</td></tr><tr><td>PostMessageWithCursorPos</td><td><code>64</code></td><td>中</td><td>可能</td><td>短暂</td><td>是</td><td>专为原神等检测实际鼠标位置的游戏设计</td></tr></tbody></table><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><ul><li>管理员权限主要取决于目标程序的权限级别，若目标程序为管理员权限，则需以管理员权限运行以保证兼容性。</li><li><code>WithCursorPos</code> 系列方式会短暂移动光标到目标位置，发送完消息后会将光标移回原位置，因此会“短暂”抢占鼠标，但不会阻止用户操作。</li></ul></div><h3 id="win32-screencap" tabindex="-1">Win32 Screencap <a class="header-anchor" href="#win32-screencap" aria-label="Permalink to &quot;Win32 Screencap&quot;">​</a></h3><blockquote><p>参考 <a href="https://github.com/MaaXYZ/MaaFramework/blob/main/include/MaaFramework/MaaDef.h#L242-L250" target="_blank" rel="noopener noreferrer">MaaDef.h</a></p></blockquote><p>选择下面的值提供。</p><p>无默认值。Client 可以选择一个作为默认值。</p><p>Win32 下不同程序处理绘制的方法不同，不存在一个通用方式。</p><table tabindex="0"><thead><tr><th>名称</th><th>API 值</th><th>速度</th><th>兼容性</th><th>需管理员权限</th><th>支持后台</th><th>说明</th></tr></thead><tbody><tr><td>GDI</td><td><code>1</code></td><td>快</td><td>中</td><td>否</td><td>否</td><td></td></tr><tr><td>FramePool</td><td><code>2</code></td><td>极快</td><td>中</td><td>否</td><td>是</td><td>Windows 10 1903+ 可用</td></tr><tr><td>DXGI_DesktopDup</td><td><code>4</code></td><td>极快</td><td>低</td><td>否</td><td>否</td><td>桌面复制（全屏输出复制）</td></tr><tr><td>DXGI_DesktopDup_Window</td><td><code>8</code></td><td>极快</td><td>低</td><td>否</td><td>否</td><td>桌面复制后裁剪</td></tr><tr><td>PrintWindow</td><td><code>16</code></td><td>中</td><td>中</td><td>否</td><td>是</td><td></td></tr><tr><td>ScreenDC</td><td><code>32</code></td><td>快</td><td>高</td><td>否</td><td>否</td><td></td></tr></tbody></table><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>Windows 在窗口最小化后会停止绘制该窗口内容，所有截图方式均无法获取有效内容，请避免窗口最小化。</p></div><h2 id="playcover-macos" tabindex="-1">PlayCover (macOS) <a class="header-anchor" href="#playcover-macos" aria-label="Permalink to &quot;PlayCover (macOS)&quot;">​</a></h2><p>PlayCover 控制器用于在 macOS 上控制通过 <a href="https://github.com/hguandl/PlayCover/releases" target="_blank" rel="noopener noreferrer">fork版PlayCover</a> 运行的 iOS 应用程序。</p><h3 id="使用方式" tabindex="-1">使用方式 <a class="header-anchor" href="#使用方式" aria-label="Permalink to &quot;使用方式&quot;">​</a></h3><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// C API</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> controller </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MaaPlayCoverControllerCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:1717&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.example.app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Python</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maa.controller </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PlayCoverController</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">controller </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PlayCoverController(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:1717&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.example.app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// NodeJS</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maa.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PlayCoverController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1:1717&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.example.app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="参数说明" tabindex="-1">参数说明 <a class="header-anchor" href="#参数说明" aria-label="Permalink to &quot;参数说明&quot;">​</a></h3><table tabindex="0"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>address</td><td>PlayTools 服务监听地址，格式为 <code>host:port</code>，如 <code>127.0.0.1:1717</code></td></tr><tr><td>uuid</td><td>目标应用的 Bundle Identifier，如 <code>com.hypergryph.arknights</code></td></tr></tbody></table><h3 id="支持的功能" tabindex="-1">支持的功能 <a class="header-anchor" href="#支持的功能" aria-label="Permalink to &quot;支持的功能&quot;">​</a></h3><table tabindex="0"><thead><tr><th>功能</th><th>支持</th><th>说明</th></tr></thead><tbody><tr><td>截图 (screencap)</td><td>✓</td><td>通过 PlayTools 协议获取 RGBA 原始数据</td></tr><tr><td>点击 (click)</td><td>✓</td><td>使用 touch_down + touch_up 实现</td></tr><tr><td>滑动 (swipe)</td><td>✓</td><td>使用三次样条插值实现平滑轨迹</td></tr><tr><td>触摸 (touch_down/move/up)</td><td>✓</td><td>仅支持单点触摸 (contact=0)</td></tr><tr><td>停止应用 (stop_app)</td><td>✓</td><td>发送终止命令</td></tr><tr><td>启动应用 (start_app)</td><td>✗</td><td>PlayCover 不支持通过协议启动应用</td></tr><tr><td>按键 (click_key/key_down/key_up)</td><td>✗</td><td>PlayTools 协议不支持</td></tr><tr><td>文本输入 (input_text)</td><td>✗</td><td>PlayTools 协议不支持</td></tr><tr><td>滚动 (scroll)</td><td>✗</td><td>PlayTools 协议不支持</td></tr></tbody></table><h3 id="前置要求" tabindex="-1">前置要求 <a class="header-anchor" href="#前置要求" aria-label="Permalink to &quot;前置要求&quot;">​</a></h3><ol><li>在 macOS 上安装 <a href="https://github.com/hguandl/PlayCover/releases" target="_blank" rel="noopener noreferrer">fork版PlayCover</a></li><li>目标 iOS 应用需要在playcover中启用 MaaTools 功能</li></ol><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>PlayCover 控制器的特性标志为 <code>MaaControllerFeature_UseMouseDownAndUpInsteadOfClick</code>，表示框架会使用 touch_down + touch_up 代替 click 操作。</p></div>',44)])])}]]);export{i as __pageData,o as default};
